"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[204],{3640:(t,e,l)=>{l.d(e,{As:()=>c,Lh:()=>a,VG:()=>i});let a=t=>{if(!t)return"";t.startsWith("http://")||t.startsWith("https://")||(t="".concat("https://eennback-002-site1.atempurl.com").concat(t.startsWith("/")?"":"/").concat(t));try{let e=new URL(t);return e.pathname=e.pathname.replace(/ /g,"%20"),e.toString()}catch(e){return console.error("Failed to encode URL:",t,e),t.replace(/ /g,"%20")}},i=t=>t?/^https?:\/\//.test(t)?a(t):a("".concat("https://eennback-002-site1.atempurl.com").concat(t.startsWith("/")?"":"/").concat(t)):void 0,c=t=>{let e;if(console.log("=== NORMALIZING IMAGE PATH ==="),console.log("Input imagePath:",t),!t)return console.log("Empty imagePath, returning empty string"),"";if(t.startsWith("http://")||t.startsWith("https://")){console.log("Already full URL, encoding and returning:",t);let e=a(t);return console.log("Encoded URL:",e),e}let l="https://eennback-002-site1.atempurl.com";console.log("Backend URL from env:",l),t.startsWith("/uploads")||t.startsWith("/images")||t.startsWith("/static")?console.log("Backend path detected, constructed result:",e="".concat(l).concat(t)):t.startsWith("/")?console.log("Absolute path detected, constructed result:",e="".concat(l).concat(t)):console.log("Relative path detected, constructed result:",e="".concat(l,"/").concat(t));let i=a(e);return console.log("Final encoded result:",i),i}},3204:(t,e,l)=>{l.d(e,{A:()=>m});var a=l(5155),i=l(5565),c=l(2115),s=l(8173),o=l.n(s),r=l(3640);let n=t=>{let{articles:e,categoryId:l,maxArticles:a=5}=t,[i,s]=(0,c.useState)({isRotating:!1,previousArticleIds:[],newArticleId:null,rotationTimestamp:0}),o=e.filter(t=>t.isPublished&&t.categoryId===l).sort((t,e)=>new Date(e.createdDate).getTime()-new Date(t.createdDate).getTime()).slice(0,a);(0,c.useEffect)(()=>{if(0===o.length)return;let t=o.map(t=>t.id);s(e=>{let{previousArticleIds:a}=e;if(0===a.length)return{...e,previousArticleIds:t};let i=t[0]!==a[0],c=t.filter(t=>!a.includes(t)),o=c.length>0;return i||o?(console.log("\uD83D\uDD04 Article rotation detected:",{categoryId:l,hasNewTopArticle:i,newArticleIds:c,previousTop:a[0],newTop:t[0]}),setTimeout(()=>{s(t=>({...t,isRotating:!1,newArticleId:null}))},1200),{...e,isRotating:!0,newArticleId:c[0]||t[0],rotationTimestamp:Date.now(),previousArticleIds:t}):e})},[o,l]);let r=(0,c.useCallback)(()=>{s(t=>({...t,isRotating:!0,rotationTimestamp:Date.now()})),setTimeout(()=>{s(t=>({...t,isRotating:!1}))},1200)},[]),n=(0,c.useCallback)(t=>i.isRotating?"".concat("article-rotation-animation"," ").concat("rotate-to-".concat(t)):"",[i.isRotating]),h=(0,c.useCallback)(t=>i.newArticleId===t,[i.newArticleId]);return{isRotating:i.isRotating,newArticleId:i.newArticleId,rotationTimestamp:i.rotationTimestamp,sortedArticles:o,triggerRotation:r,getRotationClass:n,isNewArticle:h,bigArticle:o[0]||null,smallArticles:o.slice(1,5),positions:{big:o[0]||null,topRight:o[1]||null,topLeft:o[2]||null,bottomLeft:o[3]||null,bottomRight:o[4]||null}}},h=t=>{let{article:e,isAnimating:l=!1,isNew:s=!1}=t,[n,h]=(0,c.useState)(null),[d,m]=(0,c.useState)(!1);return((0,c.useEffect)(()=>{let t=null;return(async()=>{if(!e.imagePath){console.log("BigArticle - No image path provided");return}console.log("BigArticle - Fetching image:",e.imagePath);let l="https://eennback-002-site1.atempurl.com";if(e.imagePath.includes(l.replace("https://","").replace("http://",""))||e.imagePath.includes("/uploads/"))try{let a=e.imagePath;a.startsWith("http://")||a.startsWith("https://")||(a="".concat(l).concat(a.startsWith("/")?"":"/").concat(a));let i=(0,r.Lh)(a);console.log("BigArticle - Original path:",e.imagePath),console.log("BigArticle - Full URL:",a),console.log("BigArticle - Encoded URL for fetch:",i);let c=await fetch(i,{credentials:"include",mode:"cors",cache:"no-cache"});if(console.log("BigArticle - Fetch response status:",c.status,c.statusText),c.ok){let e=await c.blob();console.log("BigArticle - Blob created, size:",e.size,"type:",e.type),t=URL.createObjectURL(e),h(t),m(!0)}else{console.error("BigArticle - Fetch failed with status:",c.status);let a=e.imagePath.startsWith(l)?e.imagePath:"".concat(l).concat(e.imagePath.startsWith("/")?"":"/").concat(e.imagePath);if(a!==e.imagePath){console.log("BigArticle - Trying alternative URL:",a);let e=(0,r.Lh)(a);console.log("BigArticle - Encoded alternative URL:",e);let l=await fetch(e,{credentials:"include",mode:"cors",cache:"no-cache"});if(l.ok){let e=await l.blob();t=URL.createObjectURL(e),h(t),m(!0);return}}console.error("BigArticle - Failed to load image from API")}}catch(t){console.error("BigArticle - Fetch error:",t)}else/^https?:\/\//.test(e.imagePath)?(console.log("BigArticle - Using direct URL for external image"),h(e.imagePath),m(!1)):console.log("BigArticle - Unknown image path format")})(),()=>{t&&(URL.revokeObjectURL(t),console.log("BigArticle - Object URL revoked"))}},[e.imagePath]),n)?(0,a.jsx)(o(),{href:"/article/".concat(e.id),className:"group h-full block",children:(0,a.jsxs)("div",{className:"relative h-full rounded-lg overflow-hidden ".concat(l?"article-rotation-animation":""),children:[(0,a.jsx)(i.default,{src:n,alt:e.articleTitle,fill:!0,className:"object-cover w-full h-full absolute inset-0 scale-110 group-hover:scale-115 transition-transform duration-300",sizes:"(max-width: 768px) 100vw, 50vw",priority:!0,unoptimized:d}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent z-10"}),(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-6 z-20",children:[(0,a.jsx)("h3",{className:"dynamic-big-title line-clamp-2 leading-tight text-white font-bold article-title-shadow",children:e.articleTitle}),s&&(0,a.jsx)("div",{className:"absolute -top-2 -right-2",children:(0,a.jsx)("div",{className:"w-4 h-4 bg-primaryOther rounded-full animate-pulse flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white text-xs",children:"\uD83C\uDD95"})})})]})]})}):(0,a.jsx)("div",{className:"relative h-full rounded-lg overflow-hidden bg-gray-200 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primaryOther mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"جاري تحميل الصورة..."})]})})},d=t=>{let{article:e,isAnimating:l=!1,position:s=""}=t,[n,h]=(0,c.useState)(null),[d,m]=(0,c.useState)(!1);return((0,c.useEffect)(()=>{let t=null;return(async()=>{if(!e.imagePath){console.log("SmallArticle - No image path provided");return}console.log("SmallArticle - Fetching image:",e.imagePath);let l="https://eennback-002-site1.atempurl.com";if(e.imagePath.includes(l.replace("https://","").replace("http://",""))||e.imagePath.includes("/uploads/"))try{let a=e.imagePath;a.startsWith("http://")||a.startsWith("https://")||(a="".concat(l).concat(a.startsWith("/")?"":"/").concat(a));let i=(0,r.Lh)(a);console.log("SmallArticle - Original path:",e.imagePath),console.log("SmallArticle - Full URL:",a),console.log("SmallArticle - Encoded URL for fetch:",i);let c=await fetch(i,{credentials:"include",mode:"cors",cache:"no-cache"});if(console.log("SmallArticle - Fetch response status:",c.status,c.statusText),c.ok){let e=await c.blob();console.log("SmallArticle - Blob created, size:",e.size,"type:",e.type),t=URL.createObjectURL(e),h(t),m(!0)}else{console.error("SmallArticle - Fetch failed with status:",c.status);let a=e.imagePath.startsWith(l)?e.imagePath:"".concat(l).concat(e.imagePath.startsWith("/")?"":"/").concat(e.imagePath);if(a!==e.imagePath){console.log("SmallArticle - Trying alternative URL:",a);let e=(0,r.Lh)(a);console.log("SmallArticle - Encoded alternative URL:",e);let l=await fetch(e,{credentials:"include",mode:"cors",cache:"no-cache"});if(l.ok){let e=await l.blob();t=URL.createObjectURL(e),h(t),m(!0);return}}console.error("SmallArticle - Failed to load image from API")}}catch(t){console.error("SmallArticle - Fetch error:",t)}else/^https?:\/\//.test(e.imagePath)?(console.log("SmallArticle - Using direct URL for external image"),h(e.imagePath),m(!1)):console.log("SmallArticle - Unknown image path format")})(),()=>{t&&(URL.revokeObjectURL(t),console.log("SmallArticle - Object URL revoked"))}},[e.imagePath]),n)?(0,a.jsx)(o(),{href:"/article/".concat(e.id),className:"group h-full block",children:(0,a.jsxs)("div",{className:"relative h-full rounded-lg overflow-hidden ".concat(l?"article-rotation-animation rotation-".concat(s):""),children:[(0,a.jsx)(i.default,{src:n,alt:e.articleTitle,fill:!0,className:"object-cover w-full h-full absolute inset-0 scale-110 group-hover:scale-115 transition-transform duration-300",sizes:"(max-width: 768px) 100vw, 25vw",unoptimized:d}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/35 via-transparent to-transparent z-10"}),(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-3 z-20",children:[(0,a.jsx)("h4",{className:"dynamic-small-title line-clamp-2 leading-tight text-white font-bold article-title-shadow",children:e.articleTitle}),l&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1",children:(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse"})})]})]})}):(0,a.jsx)("div",{className:"relative h-full rounded-lg overflow-hidden bg-gray-200 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primaryOther mb-1"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"جاري التحميل..."})]})})},m=t=>{let{category:e,showHeader:l=!0,showViewAll:i=!0,className:c=""}=t,{isRotating:s,getRotationClass:r,isNewArticle:m,positions:g}=n({articles:e.articles,categoryId:e.id,maxArticles:5});return e.articles&&0!==e.articles.length?(0,a.jsxs)("div",{className:"bg-white rounded-lg category-card overflow-hidden mb-8 ".concat(c),dir:"rtl",children:[l&&(0,a.jsx)("div",{className:"bg-primaryOther px-6 py-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-white font-bold text-xl category-title",children:e.name}),i&&(0,a.jsxs)(o(),{href:"/category/".concat(e.categorySlug),className:"text-white text-sm hover:underline flex items-center",children:["المزيد",(0,a.jsx)("span",{className:"mr-2 text-xs",children:"←"})]})]})}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"dynamic-grid",children:[(0,a.jsx)("div",{className:"big-article-container ".concat(r("big")),children:g.big&&(0,a.jsx)(h,{article:g.big,isAnimating:s,isNew:m(g.big.id)})}),(0,a.jsxs)("div",{className:"small-articles-grid",children:[g.topRight&&(0,a.jsx)("div",{className:"small-article-container ".concat(r("top-right")),children:(0,a.jsx)(d,{article:g.topRight,isAnimating:s,position:"top-right"})}),g.topLeft&&(0,a.jsx)("div",{className:"small-article-container ".concat(r("top-left")),children:(0,a.jsx)(d,{article:g.topLeft,isAnimating:s,position:"top-left"})}),g.bottomLeft&&(0,a.jsx)("div",{className:"small-article-container ".concat(r("bottom-left")),children:(0,a.jsx)(d,{article:g.bottomLeft,isAnimating:s,position:"bottom-left"})}),g.bottomRight&&(0,a.jsx)("div",{className:"small-article-container ".concat(r("bottom-right")),children:(0,a.jsx)(d,{article:g.bottomRight,isAnimating:s,position:"bottom-right"})})]})]})})]}):null}}}]);